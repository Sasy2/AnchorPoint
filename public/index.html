<!DOCTYPE html>
<html class="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Mental Health Coach - Welcome</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<style>
      .material-symbols-outlined {
        font-variation-settings:
        'FILL' 0,
        'wght' 400,
        'GRAD' 0,
        'opsz' 24
      }
    </style>
<script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              "primary": "#427cf0",
              "background-light": "#f6f6f8",
              "background-dark": "#101622",
            },
            fontFamily: {
              "display": ["Inter", "sans-serif"]
            },
            borderRadius: {"DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "full": "9999px"},
          },
        },
      }
    </script>
</head>
<body class="font-display">
<div class="relative flex h-auto min-h-screen w-full flex-col bg-background-light dark:bg-background-dark group/design-root overflow-x-hidden">
<div class="layout-container flex h-full grow flex-col">
<div class="px-4 sm:px-10 md:px-20 lg:px-40 flex flex-1 justify-center py-5">
<div class="layout-content-container flex flex-col w-full max-w-[960px] flex-1">
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-gray-200/80 dark:border-gray-700/80 px-4 sm:px-10 py-3">
<div class="flex items-center gap-4 text-gray-800 dark:text-gray-200">
<div class="size-6 text-primary">
<svg fill="none" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><path d="M6 6H42L36 24L42 42H6L12 24L6 6Z" fill="currentColor"></path></svg>
</div>
<h2 class="text-lg font-bold leading-tight tracking-[-0.015em] text-gray-900 dark:text-white">Mental Health Coach</h2>
</div>
<div class="flex flex-1 justify-end gap-8">
<div class="flex items-center gap-9"></div>
<div class="flex gap-2">
<button class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary/20 text-primary text-sm font-bold leading-normal tracking-[0.015em] transition-colors hover:bg-primary/30 dark:bg-primary/30 dark:hover:bg-primary/40">
<span class="truncate">Log In</span>
</button>
<button class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-white text-sm font-bold leading-normal tracking-[0.015em] transition-opacity hover:opacity-90">
<span class="truncate">Sign Up</span>
</button>
</div>
</div>
</header>
<main class="flex flex-1 flex-col items-center justify-center px-4 py-16 text-center">
<div class="w-full max-w-2xl">
<h1 class="text-gray-900 dark:text-white tracking-tight text-4xl sm:text-5xl font-bold leading-tight pb-3 pt-6">Welcome to your Mental Health Coach</h1>
<p class="text-gray-600 dark:text-gray-300 text-lg sm:text-xl font-normal leading-normal pb-3 pt-1 px-4">
                                I'm here to guide you through your feelings today. Let's start by checking in.
                            </p>
<div class="flex justify-center mt-8">
<div class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-[640px] px-4 py-3">
<button class="mood-btn flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-16 px-5 bg-white dark:bg-background-dark/50 text-gray-800 dark:text-gray-200 text-base font-bold leading-normal tracking-[0.015em] w-full border border-gray-200 dark:border-gray-700 shadow-sm transition-all hover:shadow-lg hover:-translate-y-1 hover:border-primary/50 dark:hover:border-primary/50" data-mood="sad">
<span class="truncate">I'm feeling sad</span>
</button>
<button class="mood-btn flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-16 px-5 bg-white dark:bg-background-dark/50 text-gray-800 dark:text-gray-200 text-base font-bold leading-normal tracking-[0.015em] w-full border border-gray-200 dark:border-gray-700 shadow-sm transition-all hover:shadow-lg hover:-translate-y-1 hover:border-primary/50 dark:hover:border-primary/50" data-mood="angry">
<span class="truncate">I'm feeling angry</span>
</button>
<button class="mood-btn flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-16 px-5 bg-white dark:bg-background-dark/50 text-gray-800 dark:text-gray-200 text-base font-bold leading-normal tracking-[0.015em] w-full border border-gray-200 dark:border-gray-700 shadow-sm transition-all hover:shadow-lg hover:-translate-y-1 hover:border-primary/50 dark:hover:border-primary/50" data-mood="energized">
<span class="truncate">I'm feeling energized</span>
</button>
<button class="mood-btn flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-16 px-5 bg-white dark:bg-background-dark/50 text-gray-800 dark:text-gray-200 text-base font-bold leading-normal tracking-[0.015em] w-full border border-gray-200 dark:border-gray-700 shadow-sm transition-all hover:shadow-lg hover:-translate-y-1 hover:border-primary/50 dark:hover:border-primary/50" data-mood="bored">
<span class="truncate">I'm feeling bored</span>
</button>
</div>
</div>
</div>
</main>
<footer class="flex flex-col gap-6 px-5 py-10 text-center @container mt-auto border-t border-solid border-gray-200/80 dark:border-gray-700/80">
<div class="flex flex-wrap items-center justify-center gap-x-8 gap-y-4 @[480px]:flex-row @[480px]:justify-around">
<a class="text-gray-500 dark:text-gray-400 text-sm font-normal leading-normal min-w-40 hover:text-primary dark:hover:text-primary transition-colors" href="#">Privacy Policy</a>
<a class="text-gray-500 dark:text-gray-400 text-sm font-normal leading-normal min-w-40 hover:text-primary dark:hover:text-primary transition-colors" href="#">Terms of Service</a>
<a class="text-gray-500 dark:text-gray-400 text-sm font-normal leading-normal min-w-40 hover:text-primary dark:hover:text-primary transition-colors" href="#">Contact Us</a>
</div>
<p class="text-gray-500 dark:text-gray-400 text-sm font-normal leading-normal">Â© 2024 Mental Health Coach. All rights reserved.</p>
</footer>
</div>
</div>
</div>
</div>
</div>

<script src="js/api.js"></script>
<script>
// Authentication and mood selection functionality
document.addEventListener('DOMContentLoaded', async function() {
    // Check if user is authenticated
    const isAuthenticated = await auth.checkAuth();
    
    if (isAuthenticated) {
        // User is logged in, show personalized content
        updateUIForAuthenticatedUser();
    } else {
        // Show login/register options
        showAuthOptions();
    }
    
    // Mood selection functionality
    const moodButtons = document.querySelectorAll('.mood-btn');
    
    moodButtons.forEach(button => {
        button.addEventListener('click', async function() {
            const mood = this.getAttribute('data-mood');
            
            if (!isAuthenticated) {
                // Redirect to login if not authenticated
                showLoginModal();
                return;
            }
            
            // Store the selected mood
            localStorage.setItem('selectedMood', mood);
            
            // Navigate to activities page
            window.location.href = 'activities.html';
        });
    });
    
    // Dark mode toggle functionality
    const darkModeToggle = document.querySelector('.dark-mode-toggle');
    if (darkModeToggle) {
        darkModeToggle.addEventListener('click', function() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', document.documentElement.classList.contains('dark'));
        });
    }
    
    // Check for saved dark mode preference
    if (localStorage.getItem('darkMode') === 'true') {
        document.documentElement.classList.add('dark');
    }
});

async function updateUIForAuthenticatedUser() {
    try {
        const user = await api.getUserProfile();
        
        // Update header to show user info
        const header = document.querySelector('header');
        const userInfo = document.createElement('div');
        userInfo.className = 'flex items-center gap-3';
        userInfo.innerHTML = `
            <div class="flex items-center gap-2">
                <span class="text-sm text-gray-600 dark:text-gray-300">Welcome back, ${user.name}</span>
                <button onclick="auth.logout()" class="text-xs text-primary hover:underline">Logout</button>
            </div>
        `;
        
        // Replace login/signup buttons with user info
        const authButtons = header.querySelector('.flex.gap-2');
        if (authButtons) {
            authButtons.replaceWith(userInfo);
        }
        
        // Load personalized activities
        await loadRecommendedActivities();
        
    } catch (error) {
        console.error('Error loading user data:', error);
        utils.showNotification('Error loading user data', 'error');
    }
}

function showAuthOptions() {
    // Add click handlers to login/signup buttons
    const buttons = document.querySelectorAll('header button');
    const loginBtn = Array.from(buttons).find(btn => btn.textContent.includes('Log In'));
    const signupBtn = Array.from(buttons).find(btn => btn.textContent.includes('Sign Up'));
    
    if (loginBtn) {
        loginBtn.addEventListener('click', () => showLoginModal());
    }
    
    if (signupBtn) {
        signupBtn.addEventListener('click', () => showSignupModal());
    }
}

async function loadRecommendedActivities() {
    try {
        const activities = await api.getRecommendedActivities();
        
        // Update activities section with personalized recommendations
        const activitiesSection = document.querySelector('.grid.grid-cols-1.sm\\:grid-cols-2');
        if (activitiesSection && activities.length > 0) {
            activitiesSection.innerHTML = activities.slice(0, 4).map(activity => `
                <button class="mood-btn flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-16 px-5 bg-white dark:bg-background-dark/50 text-gray-800 dark:text-gray-200 text-base font-bold leading-normal tracking-[0.015em] w-full border border-gray-200 dark:border-gray-700 shadow-sm transition-all hover:shadow-lg hover:-translate-y-1 hover:border-primary/50 dark:hover:border-primary/50" data-activity="${activity._id}">
                    <span class="truncate">${activity.title}</span>
                </button>
            `).join('');
            
            // Add click handlers for activity buttons
            activitiesSection.querySelectorAll('.mood-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const activityId = this.getAttribute('data-activity');
                    localStorage.setItem('selectedActivity', activityId);
                    window.location.href = 'activities.html';
                });
            });
        }
    } catch (error) {
        console.error('Error loading recommended activities:', error);
    }
}

function showLoginModal() {
    const modal = createAuthModal('login');
    document.body.appendChild(modal);
}

function showSignupModal() {
    const modal = createAuthModal('signup');
    document.body.appendChild(modal);
}

function createAuthModal(type) {
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50';
    modal.innerHTML = `
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                ${type === 'login' ? 'Log In' : 'Sign Up'}
            </h2>
            <form id="auth-form" class="space-y-4">
                ${type === 'signup' ? `
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Name</label>
                        <input type="text" id="name" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/50">
                    </div>
                ` : ''}
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email</label>
                    <input type="email" id="email" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/50">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Password</label>
                    <input type="password" id="password" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/50">
                </div>
                <div class="flex gap-3">
                    <button type="submit" class="flex-1 bg-primary text-white py-2 px-4 rounded-lg hover:bg-primary/90 transition-colors">
                        ${type === 'login' ? 'Log In' : 'Sign Up'}
                    </button>
                    <button type="button" onclick="this.closest('.fixed').remove()" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors">
                        Cancel
                    </button>
                </div>
            </form>
            <div class="mt-4 text-center">
                <button onclick="switchAuthType('${type === 'login' ? 'signup' : 'login'}')" class="text-sm text-primary hover:underline">
                    ${type === 'login' ? "Don't have an account? Sign up" : "Already have an account? Log in"}
                </button>
            </div>
        </div>
    `;
    
    // Add form submission handler
    const form = modal.querySelector('#auth-form');
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const formData = new FormData(form);
        const email = form.querySelector('#email').value;
        const password = form.querySelector('#password').value;
        const name = form.querySelector('#name')?.value;
        
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;
        
        try {
            utils.showLoading(submitBtn);
            
            let result;
            if (type === 'login') {
                result = await auth.login(email, password);
            } else {
                result = await auth.register(email, password, name);
            }
            
            if (result.success) {
                utils.showNotification(`${type === 'login' ? 'Login' : 'Registration'} successful!`, 'success');
                modal.remove();
                location.reload(); // Refresh to show authenticated state
            } else {
                utils.showNotification(result.error, 'error');
            }
        } catch (error) {
            utils.showNotification('An error occurred. Please try again.', 'error');
        } finally {
            utils.hideLoading(submitBtn, originalText);
        }
    });
    
    return modal;
}

function switchAuthType(newType) {
    // Remove current modal and show new one
    document.querySelector('.fixed.inset-0')?.remove();
    if (newType === 'login') {
        showLoginModal();
    } else {
        showSignupModal();
    }
}
</script>
</body>
</html>
